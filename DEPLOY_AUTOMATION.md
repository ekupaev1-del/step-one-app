# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –±–æ—Ç–∞

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. GitHub Actions Workflow (`.github/workflows/deploy-dev.yml`)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pipeline, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É `dev`
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π preview URL –∏–∑ Vercel
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç `MINIAPP_BASE_URL` –≤ –∫–æ–¥–µ –±–æ—Ç–∞
- ‚úÖ –ö–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –†–µ—Å—Ç–∞—Ä—Ç–∏—Ç –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç health-check

### 2. –°–∫—Ä–∏–ø—Ç—ã

**`scripts/update_miniapp_url.ts`**
- –û–±–Ω–æ–≤–ª—è–µ—Ç `MINIAPP_BASE_URL` –≤ `bot/src/index.ts`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

**`scripts/health-check-bot.ts`**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–æ—Ç–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Telegram API

**`scripts/get-vercel-preview-url.js`**
- –ü–æ–ª—É—á–∞–µ—Ç preview URL –∏–∑ Vercel API
- –ò—â–µ—Ç deployment –¥–ª—è –≤–µ—Ç–∫–∏ `dev`

**`scripts/update-bot-url.js`**
- –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ TypeScript –≤–µ—Ä—Å–∏–∏)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**`bot/ecosystem.config.js`**
- –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è production

**`bot/package.json`**
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã: `restart`, `health-check`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. GitHub Secrets

–î–æ–±–∞–≤—å –≤ GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions:

```
VERCEL_TOKEN=—Ç–≤–æ–π-vercel-token
VERCEL_PROJECT_ID=—Ç–≤–æ–π-project-id
SSH_HOST=—Ç–≤–æ–π-—Å–µ—Ä–≤–µ—Ä.com (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
SSH_USER=username (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
SSH_PRIVATE_KEY=—Ç–≤–æ–π-ssh-–∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=—Ç–≤–æ–π-bot-token (–¥–ª—è health-check)
TEST_CHAT_ID=—Ç–≤–æ–π-chat-id (–¥–ª—è health-check)
```

### 2. SSH –¥–æ—Å—Ç—É–ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

1. –°–æ–∑–¥–∞–π SSH –∫–ª—é—á –¥–ª—è GitHub Actions:
```bash
ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/github_actions_key
```

2. –î–æ–±–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
cat ~/.ssh/github_actions_key.pub | ssh user@server "cat >> ~/.ssh/authorized_keys"
```

3. –î–æ–±–∞–≤—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ GitHub Secrets –∫–∞–∫ `SSH_PRIVATE_KEY`

4. –û–±–Ω–æ–≤–∏ –ø—É—Ç—å –∫ –±–æ—Ç—É –≤ workflow (—Å—Ç—Ä–æ–∫–∞ —Å `cd /path/to/step-one-app/bot`)

### 3. Health-check (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ—Ç–∞:

1. –ü–æ–ª—É—á–∏ —Å–≤–æ–π `chat_id`:
   - –ù–∞–ø–∏—à–∏ –±–æ—Ç—É @userinfobot
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π @getidsbot

2. –î–æ–±–∞–≤—å –≤ GitHub Secrets:
   - `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - `TEST_CHAT_ID` - —Ç–≤–æ–π chat ID

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Push –≤ `dev`** ‚Üí GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ preview URL** ‚Üí –∏–∑ Vercel API
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞** ‚Üí `MINIAPP_BASE_URL` –≤ `bot/src/index.ts`
4. **–ö–æ–º–º–∏—Ç –∏ push** ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ `dev`
5. **–†–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞** ‚Üí —á–µ—Ä–µ–∑ SSH (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
6. **Health-check** ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è:
- ‚úÖ –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç URL
- ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º URL
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- ‚úÖ –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ GitHub Actions

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ workflow

1. –ó–∞–π–¥–∏ –≤ GitHub ‚Üí Actions
2. –í—ã–±–µ—Ä–∏ "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –±–æ—Ç–∞ (dev)"
3. –ù–∞–∂–º–∏ "Run workflow" ‚Üí –≤—ã–±–µ—Ä–∏ `dev` ‚Üí Run

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

```bash
# –û–±–Ω–æ–≤–∏—Ç—å URL
tsx scripts/update_miniapp_url.ts "https://step-one-app-git-dev-xxxxxx.vercel.app"

# Health-check
TELEGRAM_BOT_TOKEN=xxx TEST_CHAT_ID=xxx tsx scripts/health-check-bot.ts
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- Workflow —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ—Ç–∫–∏ `dev`
- –ö–æ–º–º–∏—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç `[skip vercel]` —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π deployment
- –ï—Å–ª–∏ SSH –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ä–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é
- Health-check –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ. –ü—Ä–æ—Å—Ç–æ –ø—É—à–∏ –≤ `dev` –∏ –≤—Å–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å–∞–º–æ! üéâ
