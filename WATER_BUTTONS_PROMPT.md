# –ü—Ä–æ–º–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –≤–æ–¥—ã –≤ Telegram –±–æ—Ç–µ

## –ó–∞–¥–∞—á–∞

–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–¥—ã –≤ Telegram –±–æ—Ç–µ —Ç–∞–∫, —á—Ç–æ–±—ã –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ø—Ä–æ—Å—Ç–æ "–≤–æ–¥–∞" (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞), –±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–ª —Å–∫–æ–ª—å–∫–æ –≤—ã–ø–∏–ª –∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª –∫–Ω–æ–ø–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "–≤–æ–¥–∞"** (–±–µ–∑ —á–∏—Å–ª–∞):
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–æ—Å–∏—Ç—å: "üíß –°–∫–æ–ª—å–∫–æ –≤–æ–¥—ã –≤—ã –≤—ã–ø–∏–ª–∏?"
   - –ü–æ–∫–∞–∑–∞—Ç—å inline –∫–Ω–æ–ø–∫–∏:
     - "0.3 –ª (300 –º–ª)"
     - "0.5 –ª (500 –º–ª)"
     - "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"

2. **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ 0.3 –ª –∏–ª–∏ 0.5 –ª:**
   - –°—Ä–∞–∑—É –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤–æ–¥—É (300 –º–ª –∏–ª–∏ 500 –º–ª)
   - –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –¥–µ–Ω—å

3. **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç":**
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ø—Ä–æ—Å–∏—Ç—å –≤–≤–µ—Å—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –º–∏–ª–ª–∏–ª–∏—Ç—Ä–∞—Ö
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 250, 300, 500)
   - –ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. `bot/src/services/water.ts` - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `isWaterRequest()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ "–≤–æ–¥–∞"
2. `bot/src/index.ts` - –∏–∑–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—Å—Ç–∞ –∏ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback_query

## –õ–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

```typescript
export function isWaterRequest(text: string): boolean {
  const normalizedText = text.toLowerCase().trim();
  const simpleWaterRequests = ['–≤–æ–¥–∞', '–≤–æ–¥—ã', '–≤–æ–¥–æ–π', 'water', 'üíß'];
  return simpleWaterRequests.includes(normalizedText);
}
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ "–≤–æ–¥–∞"

–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `bot.on("text")` –ü–ï–†–ï–î –≤—ã–∑–æ–≤–æ–º `parseWaterAmount()`:

```typescript
if (isWaterRequest(text)) {
  return ctx.reply(
    "üíß –°–∫–æ–ª—å–∫–æ –≤–æ–¥—ã –≤—ã –≤—ã–ø–∏–ª–∏?",
    {
      reply_markup: {
        inline_keyboard: [
          [
            { text: "0.3 –ª (300 –º–ª)", callback_data: "water_300" },
            { text: "0.5 –ª (500 –º–ª)", callback_data: "water_500" }
          ],
          [
            { text: "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç", callback_data: "water_custom" }
          ]
        ]
      }
    }
  );
}
```

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback_query

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

```typescript
bot.on("callback_query", async (ctx) => {
  const data = ctx.callbackQuery.data;
  
  if (data.startsWith("water_")) {
    await ctx.answerCbQuery();
    
    if (data === "water_custom") {
      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Set –æ–∂–∏–¥–∞—é—â–∏—Ö –≤–≤–æ–¥–∞
      waitingForWaterInput.add(telegram_id);
      return ctx.editMessageText("üíß –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã –≤ –º–∏–ª–ª–∏–ª–∏—Ç—Ä–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä: 250, 300, 500)");
    }
    
    // –ò–∑–≤–ª–µ—á—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ callback_data (water_300, water_500)
    const amount = parseInt(data.replace("water_", ""), 10);
    
    // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤–æ–¥—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
    await logWaterIntake(user.id, amount, 'telegram');
    const { totalMl, goalMl } = await getDailyWaterSummary(user.id);
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  }
});
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ "–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"

–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `bot.on("text")` –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π `parseWaterAmount()`:

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∞ –≤–æ–¥—ã
if (waitingForWaterInput.has(telegram_id)) {
  waitingForWaterInput.delete(telegram_id);
  
  // –ò–∑–≤–ª–µ—á—å —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞
  const numbers = text.match(/\d+/g);
  if (!numbers) {
    return ctx.reply("‚ùå –ù–µ –ø–æ–Ω—è–ª –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ. –ù–∞–ø–∏—à–∏—Ç–µ —á–∏—Å–ª–æ –≤ –º–∏–ª–ª–∏–ª–∏—Ç—Ä–∞—Ö");
  }
  
  const amount = parseInt(numbers[0], 10);
  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
}
```

### 5. –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ `bot/src/index.ts`:

```typescript
// –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ–∂–∏–¥–∞—é—â–∏—Ö –≤–≤–æ–¥–∞ –≤–æ–¥—ã
const waitingForWaterInput = new Set<number>();
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–∞:**
   - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isWaterRequest()` - –µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ "–≤–æ–¥–∞", –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏
   - –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ `waitingForWaterInput` - –µ—Å–ª–∏ –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–∏—Å–ª–æ
   - –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ `parseWaterAmount()` - –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —Ç–µ–∫—Å—Ç–µ

2. **Callback data —Ñ–æ—Ä–º–∞—Ç:**
   - `water_300` - –¥–ª—è 300 –º–ª
   - `water_500` - –¥–ª—è 500 –º–ª
   - `water_custom` - –¥–ª—è —Å–≤–æ–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 4999 –º–ª
   - –ü—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º –≤–≤–æ–¥–µ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

4. **–û—Ç–≤–µ—Ç—ã:**
   - –ü–æ—Å–ª–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –¥–µ–Ω—å
   - –§–æ—Ä–º–∞—Ç: "üíß –î–æ–±–∞–≤–ª–µ–Ω–æ: X –º–ª\n\n–°–µ–≥–æ–¥–Ω—è: Y / Z –º–ª (N%)"

## –°—Ç–∞—Ç—É—Å

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
































