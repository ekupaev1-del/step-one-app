# Как обновить бота на сервере

## Проблема
Изменения, которые делаются локально и коммитятся в `dev`, не отражаются в работающем боте, потому что бот запущен на сервере из другой директории/ветки.

## Решение

### Вариант 1: Обновить бота на сервере через SSH

1. Подключитесь к серверу:
```bash
ssh user@your-server
```

2. Перейдите в директорию бота:
```bash
cd /path/to/step-one-app/bot
```

3. Проверьте текущую ветку:
```bash
git branch
```

4. Если вы в `main`, переключитесь на `dev`:
```bash
git checkout dev
```

5. Обновите код:
```bash
git pull origin dev
```

6. Установите зависимости (если нужно):
```bash
npm install --production
```

7. Пересоберите проект:
```bash
npm run build
```

8. Перезапустите бота:
```bash
pm2 restart step-one-bot
```

9. Проверьте логи:
```bash
pm2 logs step-one-bot --lines 50
```

### Вариант 2: Использовать deploy.sh скрипт

1. Отредактируйте `bot/deploy.sh` и укажите правильные данные:
   - `SERVER_USER` - ваш пользователь на сервере
   - `SERVER_HOST` - IP или домен сервера
   - `SERVER_PATH` - путь к проекту на сервере
   - `BRANCH` - ветка (должна быть `dev`)

2. Запустите скрипт:
```bash
cd bot
./deploy.sh
```

### Вариант 3: Если бот запущен локально

Если бот запущен локально (не на сервере), просто перезапустите его:

```bash
cd bot
npm run build
pm2 restart step-one-bot
# или если используете npm run dev:
# Остановите процесс (Ctrl+C) и запустите снова: npm run dev
```

## Проверка

После обновления проверьте логи бота. Вы должны увидеть:
- `[bot] [MESSAGE HANDLER]` - логи обработки сообщений
- `[bot] [handleQuestionnaireSaved]` - логи обработки данных из Mini App

Если этих логов нет, значит бот все еще использует старую версию кода.

## Важно

- Убедитесь, что на сервере используется правильная ветка (`dev` для разработки)
- После каждого изменения кода нужно перезапускать бота через `pm2 restart`
- Проверяйте логи после перезапуска, чтобы убедиться, что изменения применились
